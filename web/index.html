<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agile Practice Prediction System</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <img src="/static/ou-logo.png" alt="Open University of Israel" class="header-logo" onerror="this.src='/static/ou-logo.svg'; this.onerror=null;">
                <div class="header-text">
                    <h1>Agile Practice Prediction System</h1>
                    <p class="subtitle">MSc Computer Science - Advanced Project Course | Open University of Israel</p>
                    <p class="subtitle" style="font-size: 0.9em; opacity: 0.8;">
                        ML-Driven Agile Transformation (Collaborative Filtering + Markov Chain Sequence Learning)
                    </p>
                    <p class="subtitle" style="font-size: 0.85em; opacity: 0.7; margin-top: 5px;">
                        Student: Erez Morabia | Advisor: Shmuel Tyszberowicz | Year: 2025
                    </p>
                </div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="recommendations">Recommendations</button>
            <button class="tab-btn" data-tab="backtest">Backtest Validation</button>
            <button class="tab-btn" data-tab="stats">Statistics</button>
            <button class="tab-btn" data-tab="sequences">Sequences</button>
        </nav>

        <!-- Recommendations Tab -->
        <div id="recommendations-tab" class="tab-content active">
            <div class="section">
                <h2>Get Recommendations</h2>
                
                <div class="form-group">
                    <label for="team-select">Select Team:</label>
                    <select id="team-select">
                        <option value="">Loading teams...</option>
                    </select>
                    <small style="display: block; margin-top: 5px; color: #666;">The number in parentheses shows how many months of historical data are available for each team. More months typically mean more reliable recommendations.</small>
                </div>

                <div class="form-group">
                    <label for="month-select">Select Month to Predict:</label>
                    <select id="month-select" disabled>
                        <option value="">Select a team first</option>
                    </select>
                    <small style="display: block; margin-top: 5px; color: #666;">Month to predict starts from month 3 (we need months 1-2 as history)</small>
                </div>

                <button id="get-recommendations-btn" class="btn btn-primary" disabled>Get Recommendations</button>
            </div>

            <div id="recommendations-results" class="results hidden"></div>
        </div>

        <!-- Backtest Tab -->
        <div id="backtest-tab" class="tab-content">
            <div class="section">
                <h2>Run Backtest Validation (Rolling Window)</h2>
                <p>Validate recommendations against historical data using rolling window approach</p>
                <div class="info-box" style="margin-bottom: 20px;">
                    <strong>Rolling Window Approach:</strong>
                    <ul>
                        <li>For each month starting from month 4:
                            <ul>
                                <li>Train on all previous months</li>
                                <li>Predict what will happen in that month</li>
                                <li>Validate against actual data (checks that month, month+1, AND month+2)</li>
                            </ul>
                        </li>
                        <li>Shows accuracy per month and overall average</li>
                        <li><strong>Note:</strong> Validation checks 3 months ahead to account for adoption timelines (This aligns with recommendation logic which looks up to 3 months ahead)</li>
                    </ul>
                </div>

                <div class="info-box" style="background: #d4edda; border-left: 4px solid #28a745; margin-bottom: 20px;">
                    <strong>✅ Academic Rigor: No Data Leakage</strong>
                    <p><strong>Strict Temporal Ordering Guaranteed:</strong></p>
                    <ul>
                        <li>The model NEVER uses future data to make past predictions</li>
                        <li>For each prediction at month M:
                            <ul>
                                <li>Similar teams found from months &lt; M only</li>
                                <li>Sequences learned from months &lt; M only</li>
                                <li>No "peeking" at future improvements</li>
                            </ul>
                        </li>
                        <li>Validated using rolling window backtest (time-series cross-validation)</li>
                        <li>This ensures accuracy metrics (49%, 2.0x vs random) are trustworthy</li>
                    </ul>
                </div>

                <!-- Configuration Panel -->
                <div class="config-panel" style="margin-bottom: 20px; border: 1px solid #ddd; padding: 20px; border-radius: 8px; background: #f9f9f9;">
                    <h3 style="margin-top: 0;">Fine-Tuning Configuration</h3>
                    
                    <!-- Primary Parameters -->
                    <div class="config-section">
                        <h4 style="margin-top: 0; cursor: pointer;" onclick="toggleConfigSection('primary-config')">
                            <span id="primary-config-toggle">▼</span> Primary Parameters
                        </h4>
                        <div id="primary-config" class="config-content">
                            <div class="form-group">
                                <label for="config-top-n">
                                    Number of Recommendations:
                                    <span id="config-top-n-value">2</span>
                                </label>
                                <input type="range" id="config-top-n" min="1" max="10" value="2" step="1">
                                <small>Controls how many best practices will be recommended for a team to implement in the following month. More recommendations give teams more options but also increase the chance of getting one right by chance (higher random baseline).</small>
                            </div>

                            <div class="form-group">
                                <label for="config-similarity-weight">
                                    Similarity Weight:
                                    <span id="config-similarity-weight-value">0.6</span>
                                    (Sequence Weight: <span id="config-sequence-weight-value">0.4</span>)
                                </label>
                                <input type="range" id="config-similarity-weight" min="0" max="1" value="0.6" step="0.05">
                                <small>Controls the balance between two recommendation sources: (1) What similar teams improved (peer learning) vs (2) Natural practice sequences (what typically follows other practices). Higher values favor peer learning, lower values favor natural sequences.</small>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Parameters -->
                    <div class="config-section">
                        <h4 style="cursor: pointer;" onclick="toggleConfigSection('advanced-config')">
                            <span id="advanced-config-toggle">▶</span> Advanced Parameters
                        </h4>
                        <div id="advanced-config" class="config-content" style="display: none;">
                            <div class="form-group">
                                <label for="config-k-similar">
                                    Number of Similar Teams:
                                    <span id="config-k-similar-value">19</span>
                                </label>
                                <input type="range" id="config-k-similar" min="3" max="20" value="19" step="1">
                                <small>How many similar teams to consider when making recommendations. More teams provide more data but may include less relevant teams. Fewer teams focus on the most similar teams.</small>
                            </div>

                            <div class="form-group">
                                <label for="config-lookahead-months">
                                    Months to Look Ahead for Similar Teams:
                                    <span id="config-lookahead-months-value">3</span>
                                </label>
                                <input type="range" id="config-lookahead-months" min="1" max="6" value="3" step="1">
                                <small>How far ahead to check what similar teams improved. For example, if set to 3, the system looks at what similar teams improved 1-3 months after they were in a similar state.</small>
                            </div>

                            <div class="form-group">
                                <label for="config-recent-months">
                                    Months to Check for Recent Improvements:
                                    <span id="config-recent-months-value">3</span>
                                </label>
                                <input type="range" id="config-recent-months" min="1" max="6" value="3" step="1">
                                <small>How far back to look for your team's own improvements to trigger sequence boosts. If your team improved a practice within this timeframe, related practices get boosted.</small>
                            </div>

                            <div class="form-group">
                                <label for="config-min-similarity">
                                    Minimum Similarity Threshold:
                                    <span id="config-min-similarity-value">0.75</span>
                                </label>
                                <input type="range" id="config-min-similarity" min="0" max="1" value="0.75" step="0.05">
                                <small>Minimum similarity required for a team to be considered 'similar'. Teams below this threshold are ignored. Set to 0.0 to consider all teams regardless of similarity.</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="run-backtest-btn" class="btn btn-primary">Run Backtest Validation with Configuration</button>
                    <button id="find-optimal-btn" class="btn btn-secondary" style="background: #6c757d; color: white;">Find Optimal Configuration</button>
                    <button id="view-latest-results-btn" class="btn btn-secondary" style="background: #17a2b8; color: white;">View Latest Results</button>
                    <button id="upload-results-btn" class="btn btn-secondary" style="background: #28a745; color: white;">Upload Results</button>
                </div>
                <input type="file" id="upload-results-input" accept=".json" style="display: none;">
                
                <!-- Optimization Progress -->
                <div id="optimization-progress" class="results hidden" style="margin-top: 20px;">
                    <div class="info-box">
                        <h4>Searching for Optimal Configuration...</h4>
                        <div id="optimization-progress-text">Initializing...</div>
                        <div style="margin-top: 10px;">
                            <div style="background: #e9ecef; border-radius: 4px; height: 20px; overflow: hidden;">
                                <div id="optimization-progress-bar" style="background: #007bff; height: 100%; width: 0%; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button id="cancel-optimization-btn" class="btn btn-secondary" style="background: #dc3545; color: white;">Cancel Optimization</button>
                        </div>
                    </div>
                </div>
                
                <!-- Optimization Results -->
                <div id="optimization-results" class="results hidden" style="margin-top: 20px;"></div>
            </div>

            <div id="backtest-results" class="results hidden"></div>
        </div>

        <!-- Statistics Tab -->
        <div id="stats-tab" class="tab-content">
            <div class="section">
                <h2>System Statistics</h2>
            </div>

            <div id="stats-results" class="results hidden"></div>
        </div>

        <!-- Sequences Tab -->
        <div id="sequences-tab" class="tab-content">
            <div class="section">
                <h2>Improvement Sequences</h2>
                <p>View learned improvement patterns from all teams and practices</p>
            </div>

            <div id="sequences-results" class="results hidden"></div>
        </div>

        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>

        <div id="error" class="error hidden"></div>
    </div>

    <script src="/static/js/api.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>

